# Claude Session State - 5d-adventsbazar Project

## Project Overview
Static website generator for Christmas greeting pages from CSV data.
Deployed via GitHub Pages at: https://st-ursula-gymnasium-org.github.io/5d-adventsbazar/

## Current State (2025-12-07)

### Statistics
- Total greeting pages: 38
- ID range: 410-780
- Last added: Claude AI (ID 780)

### Key Files and Structure

#### Data
- `data/data.csv` - Semicolon-delimited CSV with fields: ID;Timestamp;Name;Message
- Multiline messages supported via quoted fields
- UTF-8 encoding for German characters (ä, ö, ü, ß, ©)

#### Templates
- `templates/template.html` - HTML template with {{NAME}} and {{MESSAGE}} placeholders
- Warm color scheme (#8B4513 brown, #D2691E chocolate, #FFF8DC cornsilk)
- Includes video link at bottom of each card

#### Scripts
- `scripts/parse_csv.awk` - AWK script that parses CSV into temp files
  - Identifies records by lines starting with ID numbers
  - Handles multiline quoted fields correctly
- `scripts/generate_pages.sh` - Main generation script
  - UTF-8 locale settings (LC_ALL=C.UTF-8, LANG=C.UTF-8)
  - Function-based architecture: init, parse, generate, process, main
  - UUID-based filenames: {ID}-{UUID}.html

#### Makefile
- Uses `.ONESHELL:` directive
- UTF-8 locale exports
- Main targets:
  - `generate_pages` - Generate all HTML pages from CSV
  - `publish` - Regenerate + commit docs/ + push to GitHub
  - `push` - Push existing commits only
- GitHub credentials from: /home/a2/pswd/st-ursula-gymnasium-org/

#### Output
- `docs/index.html` - Random redirect with cache-busting headers
- `docs/p/*.html` - Individual greeting pages
- `docs/video.html` - Video streaming page (autoplay, loop, muted)
- `docs/videos/christmass-market-5d.mp4` - Promotional video

## Technical Implementation Details

### CSV Parsing Solution
**Problem**: Initial `while read` approach broke on newlines in multiline messages
**Solution**: Two-stage approach:
1. AWK script identifies records (lines starting with numbers) and writes to temp files
2. Bash script reads complete temp files to process each record

### Character Encoding
- All files use UTF-8 encoding
- Template was initially ISO-8859-1, converted with iconv
- Locale settings in Makefile and scripts ensure proper handling

### Cache Busting
index.html includes meta tags to prevent caching:
```html
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
```

### Video Implementation
- Autoplay with muted (required for autoplay to work)
- Loop for continuous playback
- Playsinline for mobile compatibility
- Controls visible for user control

## Coding Standards

### Documented in PROJECT_INSTRUCTIONS.md
1. Use `.ONESHELL:` directive in Makefile
2. Keep Makefile simple, delegate to scripts
3. Function-based bash scripts with clear separation
4. Plain ASCII text only (no emojis in commits)
5. UTF-8 encoding throughout
6. Standard Linux tools preferred (bash, awk, sed)

## Git Workflow

### Branches
- Main branch: `main`
- GitHub Pages deploys from: `docs/` folder

### Commit Messages
- Plain ASCII text only
- Auto-generated by publish target
- Format: "Update generated pages"

### Authentication
- Username: stored in /home/a2/pswd/st-ursula-gymnasium-org/github-user.txt
- Token: stored in /home/a2/pswd/st-ursula-gymnasium-org/github-password.txt

## Known Issues & Solutions

### Issue: Parsing created 54 pages instead of 24
**Cause**: `while read` broke on newlines in quoted fields
**Fix**: AWK-based parser with temp files

### Issue: Characters displayed as � (ß → �, © → �)
**Cause**: Template encoding mismatch (ISO-8859-1 vs UTF-8)
**Fix**: `iconv -f ISO-8859-1 -t UTF-8` + locale settings

### Issue: Random redirect caching
**Cause**: Browser cached index.html
**Fix**: Added cache-busting meta tags

### Issue: Spelling errors
**Fixes applied**:
- "Complement" → "Compliments"
- "ihrer" → "Ihrer"
- "das" → "dass"
- "Eich" → "Euch"
- "viele Schokolade" → "viel Schokolade"
- "Lina Conrad" → "Lina" (shortened)

## Recent Session History

### Last Session (2025-12-07)
1. Added 3 wishes from Julia (IDs 750, 760, 770)
2. Added 1 wish from Claude AI (ID 780) - German poem
3. Published all changes to GitHub Pages

### Previous Major Updates
- Created video.html with autoplay/loop
- Added video link to all greeting pages
- Fixed all spelling errors in data.csv
- Implemented publish workflow
- Fixed character encoding issues
- Solved multiline CSV parsing

## Content Notes

### Kids with Multiple Entries
- Konstantin: 5 entries (410, 650, 660, 670, 680)
- Olivia: 3 entries (440, 460, 470)
- Sofia: 4 entries (500, 510, 520, 530)
- Merle: 4 entries (610, 620, 630, 640)
- Lina: 2 entries (710, 740)
- Julia: 3 entries (750, 760, 770)
- Constanze: 2 entries (570, 580)
- Chetria: 2 entries (690, 700)
- Kelson: 2 entries (420, 480)

### Special Entries
- Johannes (430): Poem by Heinz Erhardt
- Claude AI (780): Original German poem

## File Permissions & Access
All files readable with pre-approved paths:
- /home/a2/src/st-ursula/5d-adventsbazar/**
- /home/a2/pswd/st-ursula-gymnasium-org/**

## Next Possible Tasks
- Add more greetings as they come in
- Update video content if needed
- Fix spelling errors if reported
- Generate QR codes for printing (PDF montages)

## Important Commands

### Generate pages only
```bash
make generate_pages
```

### Publish (regenerate + commit + push)
```bash
make publish
```

### Push existing commits
```bash
make push
```

### Manual generation
```bash
./scripts/generate_pages.sh
```

## Session Continuation Instructions
When resuming:
1. Check data/data.csv for any new entries
2. Verify current page count matches expected (38 as of 2025-12-07)
3. Remember: no emojis, UTF-8 encoding, plain ASCII commits
4. Use temp files approach for CSV parsing
5. All spelling should be checked in German and English
